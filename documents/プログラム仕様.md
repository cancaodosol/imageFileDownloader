# 画像ダウンロードツール 簡易仕様

## 目的
- `target.csv` の画像URLを一括ダウンロードして `downloads/` に保存し、再実行時は成功済みURLを自動スキップする。

## 前提
- Python 3.10+（標準ライブラリのみ使用）、UTF-8入出力。

## 入力（CSVレイアウト）
`target.csv` の行構成は以下のとおり。

| 列番号 | 項目   | 必須 | 内容                                   | 例                                   |
| ------ | ------ | ---- | -------------------------------------- | ------------------------------------ |
| 1      | 名称   | 任意 | 画像の名称。URLからファイル名が取れない場合のベース名に使用。 | 北極老人線香「紫微」                  |
| 2      | 画像URL | 必須 | 画像取得元のURL。                      | https://example.com/image.jpg        |
| 3以降  | なし   | 不要 | 無視される。                           | -                                    |
| 空行/列不足 | - | - | 行ごとにスキップ。 | - |

## 出力
- ダウンロードファイル: `downloads/`
  - ファイル名ルール:
    - 元URLのファイル名を使用（例: `https://example.com/photo.jpg` → `photo.jpg`）
    - 禁止文字（`\\ / : * ? " < > |`）は `_` に置換
    - 拡張子はURL優先。無い場合は Content-Type から推定し、不明なら `.bin`
- ログ出力: `logs/`
  - `logs/success.log`: ダウンロード成功した「保存ファイル名」を1行ずつ追記（再実行時のスキップ判定に使用）。
  - `logs/failed.log`: ダウンロード失敗したURLとエラー内容を1行で記録。

## 動作概要
1. `target.csv` が無ければ終了。
2. `logs/success.log` を読み込み、成功済みの保存ファイル名を集合化。
3. CSVを先頭から処理し、各行で以下を出し分ける:
   - 成功済みファイル名: `[SKIP] {名称} <- {URL}`
   - 新規ファイル・成功: ダウンロードして `[OK] {名称} -> {保存パス}`、保存ファイル名を `success.log` に追記
   - 新規ファイル・失敗: `[NG] {名称} <- {URL} ({エラー})`、`failed.log` にURLとエラー記録
4. 50件ごとに追加待機（デフォルト5秒）。
5. 最後に `Done. {保存数}/{処理件数} files saved.` を表示。

## 設定（`download_images.py` 冒頭）

| 設定名 | 意味 | 現在値 |
| ------ | ---- | ------ |
| `CSV_PATH` | 入力CSVパス | `target.csv` |
| `DOWNLOAD_DIR` | ダウンロード保存先 | `downloads` |
| `LOG_DIR` | ログ保存ディレクトリ | `logs` |
| `SUCCESS_LOG` | 成功URLログ | `logs/success.log` |
| `FAILED_LOG` | 失敗URLログ | `logs/failed.log` |
| `USER_AGENT` | HTTPリクエストのUA文字列 | `image-downloader/1.0 (canac0.d0.s0lh1de.m24w@gmail.com)` |
| `DELAY_SECONDS` | 各リクエスト間の待機秒 | `0.5` |
| `BATCH_PAUSE_EVERY` | 追加待機を入れる件数 | `50` |
| `BATCH_PAUSE_SECONDS` | 追加待機の秒数 | `5` |

## 実行方法
```bash
python3 download_images.py
```
`downloads/` と `logs/` の内容を確認する。
